<script>
  let correctAnswer = "";
  const morseMap = {
    A: ".-",    B: "-...",  C: "-.-.",  D: "-..",
    E: ".",     F: "..-.",  G: "--.",   H: "....",
    I: "..",    J: ".---",  K: "-.-",   L: ".-..",
    M: "--",    N: "-.",    O: "---",   P: ".--.",
    Q: "--.-",  R: ".-.",   S: "...",   T: "-",
    U: "..-",   V: "...-",  W: ".--",   X: "-..-",
    Y: "-.--",  Z: "--.."
  };

  const lamp = document.getElementById('lamp');
  let morseSequence = [];
  let morseIndex = 0;

  function animateLamp() {
    const symbol = morseSequence[morseIndex];
    if (symbol === ".") {
      lamp.classList.add("on");
      setTimeout(() => {
        lamp.classList.remove("on");
        setTimeout(next, 200);
      }, 300);
    } else if (symbol === "-") {
      lamp.classList.add("on");
      setTimeout(() => {
        lamp.classList.remove("on");
        setTimeout(next, 300);
      }, 800);
    } else {
      setTimeout(next, 400); // space between letters
    }
  }

  function next() {
    morseIndex = (morseIndex + 1) % morseSequence.length;
    animateLamp();
  }

  // Load answer from answers.txt
  fetch("answers.txt")
    .then(res => res.text())
    .then(text => {
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      if (lines.length >= 3) {
        correctAnswer = lines[2].toUpperCase();

        // build morse sequence from correctAnswer
        morseSequence = correctAnswer.split("").flatMap(letter => {
          const code = morseMap[letter] || "";
          return code.split("").concat(" "); // space between letters
        });

        // start animation
        animateLamp();

        // if already solved, show answer and prefill
        if (localStorage.getItem("puzzle3") === "solved") {
          document.getElementById("result").innerText = "242 1 34";
          document.getElementById("answerInput").value = correctAnswer;
        }
      } else {
        document.getElementById("result").innerText = "Error: Not enough lines in answers.txt.";
      }
    })
    .catch(err => {
      console.error("Failed to load answers.txt:", err);
      document.getElementById("result").innerText = "Error loading answer.";
    });

  function checkAnswer() {
    const input = document.getElementById('answerInput').value.trim().toUpperCase();
    const message = document.getElementById('result');
    if (input === correctAnswer) {
      localStorage.setItem("puzzle3", "solved");
      message.innerText = "242 1 34";
    } else {
      message.innerText = "Try again.";
    }
  }
</script>
